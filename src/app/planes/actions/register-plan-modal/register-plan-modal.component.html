<div class="modal-backdrop" *ngIf="isVisible" (click)="close()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button mat-icon-button class="close-button" (click)="close()">
      <mat-icon class="close-icon">close</mat-icon>
    </button>
    <h2>Registrar Nuevo Plan</h2>

    <form [formGroup]="planForm" (ngSubmit)="onSubmit()">
      <!-- Nombre del Plan -->
      <mat-form-field appearance="outline" class="example-full-width">
        <mat-label>Nombre del Plan</mat-label>
        <input matInput type="text" formControlName="nombrePlan" required />
        <mat-error *ngIf="planForm.get('nombrePlan')?.hasError('required')">
          El nombre del plan es obligatorio
        </mat-error>
      </mat-form-field>

      <!-- Código SAT y Clave Unidad -->
      <div class="form-row">
        <mat-form-field appearance="outline" class="example-full-width">
          <mat-label>Código SAT</mat-label>
          <mat-select formControlName="codigoSAT" required>
            <mat-option value="12345678">12345678</mat-option>
            <mat-option value="23456789">23456789</mat-option>
          </mat-select>
          <mat-error *ngIf="planForm.get('codigoSAT')?.hasError('required')">
            El código SAT es obligatorio
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="example-full-width">
          <mat-label>Clave Unidad</mat-label>
          <input matInput type="text" formControlName="claveUnidad" required />
          <mat-error *ngIf="planForm.get('claveUnidad')?.hasError('required')">
            La clave unidad es obligatoria
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Precios -->
      <div class="form-row">
        <mat-form-field appearance="outline" floatLabel="always">
          <mat-label>Precio Bruto</mat-label>
          <input matInput type="number" formControlName="precio" class="example-right-align" placeholder="0.00" />
          <span matTextPrefix>$&nbsp;</span>
          <mat-error *ngIf="planForm.get('precio')?.hasError('required')">
            El precio bruto es obligatorio
          </mat-error>
          <mat-error *ngIf="planForm.get('precio')?.hasError('min')">
            El precio debe ser mayor o igual a 0
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" floatLabel="always">
          <mat-label>Precio Neto (con IVA)</mat-label>
          <input matInput type="number" formControlName="precioConIVA" class="example-right-align" placeholder="0.00" />
          <span matTextPrefix>$&nbsp;</span>
          <mat-error *ngIf="planForm.get('precioConIVA')?.hasError('required')">
            El precio neto es obligatorio
          </mat-error>
        </mat-form-field>
      </div>

      <!-- No. Identificación y Duración -->
      <div class="form-row">
        <mat-form-field appearance="outline" class="example-full-width">
          <mat-label>No. de Identificación</mat-label>
          <input matInput type="text" formControlName="noIdentificacion" required />
          <mat-error *ngIf="planForm.get('noIdentificacion')?.hasError('required')">
            El No. de Identificación es obligatorio
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="example-full-width">
          <mat-label>Duración</mat-label>
          <mat-select formControlName="duracion" required>
            <mat-option value="1 mes">1 mes</mat-option>
            <mat-option value="3 meses">3 meses</mat-option>
            <mat-option value="6 meses">6 meses</mat-option>
            <mat-option value="1 año">1 año</mat-option>
          </mat-select>
          <mat-error *ngIf="planForm.get('duracion')?.hasError('required')">
            La duración es obligatoria
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Servicios y Color -->
      <div class="form-row">
        <div class="slider-container example-full-width">
          <label for="servicios">Servicios abarcados</label>
          <input
            type="range"
            id="servicios"
            formControlName="servicios"
            min="0"
            max="100"
            step="10"
          />
          <span>{{ planForm.get('servicios')?.value }}%</span>
        </div>

        <mat-form-field appearance="outline" class="example-full-width">
          <mat-label>Color</mat-label>
          <mat-select formControlName="color" required>
            <mat-option value="#4CAF50">Verde</mat-option>
            <mat-option value="#2196F3">Azul</mat-option>
            <mat-option value="#FFC107">Amarillo</mat-option>
            <mat-option value="#9C27B0">Púrpura</mat-option>
            <mat-option value="#FF5722">Naranja</mat-option>
            <mat-option value="#607D8B">Gris azulado</mat-option>
          </mat-select>
          <mat-error *ngIf="planForm.get('color')?.hasError('required')">
            El color es obligatorio
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Botones -->
      <div class="modal-actions">
        <button mat-button type="button" (click)="close()">Cancelar</button>
        <button mat-raised-button type="submit" class="save-button" [disabled]="!planForm.valid">
          Guardar
        </button>
      </div>
    </form>
  </div>
</div>
